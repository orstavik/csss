<style></style>
<script type="module">
  function shortToText(short) {
    const actualTxt = parseCssShorts(short)?.full;
    tester.sheet.insertRule(actualTxt, 0);
    return tester.sheet.cssRules[0].cssText;
  }

  import { parseCssShorts } from "../src/engine1.js";
  import { diff } from "https://cdn.jsdelivr.net/gh/orstavik/making-a@25.07.20.08/difference.js";
  // if (!location.hash) location.hash = "hpOne,hpTwo,hpBorder,hpLayout,hpCalVar,hpSupers,hpBg";
  if (!location.hash) location.hash = "hpBg";
  const paths = location.hash.slice(1).split(",").map(p => p + ".html");
  const tester = document.querySelector('style');
  for (let file of paths) {
    const txt = await (await fetch(file)).text();
    const comments = txt.match(/\/\*[\s\S]*?\*\//g).map(c => c.slice(2, -2).trim());
    document.body.insertAdjacentHTML('beforeend', txt);
    const rules = document.body.lastElementChild.sheet.cssRules;
    for (let i = 0; i < rules.length; i++) {
      const short = comments[i];
      const actual = shortToText(short);
      const expected = rules[i].cssText;
      if (actual == expected) {
        console.log(`‚úÖ ${short}`);
        continue;
      }
      const d = diff(actual, expected);
      const noMatch = d.find(({ type, a, b }) => type != "match" && (a.trim() || b.trim()))
      if (!noMatch) {
        console.log(`üü¶ ${short}`);
      } else {
        // debugger;
        console.log(`‚ùå ${short}`);
        console.log("expected:", expected);
        console.log("actual:", actual);
        console.log(`noMatch:`, noMatch);
        console.log("diff:", d);
      }
    }
  }
</script>